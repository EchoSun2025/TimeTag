# TimeTag 功能需求文档

本文档记录所有功能需求和改动历史。

---

## 基础设计原则

- 极简黑白风格（类似 Notion 美学）
- 彩色标签（Google Material 配色）
- 全英文界面
- 不使用任何 emoji 图标

---

## 已实现功能

### 1. 整体布局

#### 1.1 主界面布局
- **左侧 1/3**：完整时间线（类似 Toggl）
  - 双击空白处创建新记录
  - 拖拽时间块改变时间
  - 拖拽起始/结束点调整时长
  - 支持同一时间段多个任务并排显示
  - Alt + 鼠标滚轮缩放时间线
  - `-` `+` 按钮缩放（以视图中心为原点）
  - `·` 按钮定位到当前时间
  - 当前时间红色横线指示器（每分钟更新）
  - 时间线背景淡黄色

#### 1.2 右侧布局
- **右上 1/5**：日期控制和日统计
  - 日期显示格式：`2026/02/14 Sat.`
  - Today 按钮快速跳转今日
  - Total hours 显示（45h 30m 格式）
  - 直接展开显示各 tag 时间（用 tag 颜色 + 时间）
  - 浅黄色底色

- **右中 1/5**：Tags 标签区
  - 点击标签切换是否计入统计（变灰表示不计入）
  - `+ New Tag` 按钮创建新标签
  - 所有标签显示为圆角 pill 样式（rounded-full）

- **右下剩余部分**：周统计
  - 周显示格式：`0209-0215 Feb.Week2`
  - 5 days / 7 days 切换按钮
  - `+` 按钮展开详细记录
  - 每日总结显示格式优化

### 2. 时间记录功能

#### 2.1 记录创建与编辑
- **快捷键 Alt+X**：
  - 第一次按：打开 New Record 窗口（直接模态框，无 mini 窗口）
  - 开始录制后切换到 mini 模式
  - 第二次按：停止录制

- **New Record / Edit Record 窗口**：
  - 宽度加大（max-w-2xl）
  - Tags 在 Description 上方
  - 键盘导航：
    - `↑↓` 在 tags 中切换行
    - `←→` 在 tags 中横向切换
    - `↓` 从 tags 进入 description
    - `↑` 从 description 返回 tags
    - `Space` 切换 tag 选择
    - `Enter` 开始录制/保存
  - 自动选择第一个 tag
  - 自动填充第一个 subItem 到描述

#### 2.2 时间块交互
- **删除功能**：右上角 `×` 按钮
- **继续功能**：左上角 `▶` 按钮（用相同描述和 tag 开始新记录）
- **拖拽移动**：点击时间块拖动
- **拖拽调整**：拖动上下边缘调整时长
- **15min Round 功能**：
  - 开关按钮在标题栏
  - 开启后拖拽自动吸附 15 分钟
  - 对已有记录也生效
- **短记录显示优化**：
  - 短于 15 分钟的记录强制显示为 15 分钟高度
  - 小于 10 分钟间隔的记录并排分栏显示
  - 分栏时较早的记录在左侧

#### 2.3 活动记录占位符
- 正在录制时在 timeline 上显示占位符
  - 虚线边框，带脉冲动画
  - 每 15 分钟刷新一次长度
  - 参与分栏布局（与其他记录一致的分栏规则）
  - 显示 "recording..." 文字

### 3. Mini Window（迷你窗口）

#### 3.1 尺寸与布局
- 宽度：252px
- 高度：142px
- 位置：左上角 (20, 20)
- 可拖动

#### 3.2 内容显示
- 单行布局：`[Timer] [Description + Tag (上下)] [Stop Button]`
- Timer：
  - HH:MM:SS 格式
  - 字体：font-black, 1.3rem
  - 颜色：蓝绿色 (#2DD4BF)
- Description：
  - 字体：0.82rem
  - 在 timer 右侧，tag 上方
- Tag：
  - 字体：0.563rem
  - 圆角 pill 样式
  - 在 description 下方
- Stop Button：
  - 尺寸：21x21px
  - 红色方形按钮
- 上下各 7px 内边距

### 4. TopBar（标题栏）

#### 4.1 布局
- 左侧：TimeTag 标题
- 中间：当前/最近记录显示
  - 描述 + Tag（横向排列）
  - 正在录制时：淡绿色背景 + 红色方形停止按钮
  - 最近完成时：淡灰色背景 + 绿色三角继续按钮
- 右侧：
  - `15min Round` 开关按钮
  - `Settings` 按钮

### 5. Settings（设置页面）

#### 5.1 布局
- 左侧 1/3：标签列表
- 右侧 2/3：标签编辑器

#### 5.2 标签编辑功能
- **自动保存**：任何修改立即保存到数据库
- **Tag Name**：可编辑标签名称
- **Color Picker**：16 色 Google Material 调色板
- **Leisure Tag**：
  - 勾选后不计入总时间统计
  - 自动变为淡绿色 (#86EFAC)
- **Sub-items**：
  - 文本框输入（每行一个）
  - 用于快速填充描述
- **Fixed Time Schedules**：
  - 可添加多个定期时间表
  - 设置星期、开始时间、结束时间
  - 自动在 timeline 生成可编辑的记录块
  - 防重复逻辑：2 小时窗口内检查相同 tag 和描述
- **Delete Tag**：红色按钮删除标签（带确认）
- **Close**：关闭 settings 窗口（所有更改已自动保存）

### 6. 数据统计

#### 6.1 日统计
- 总时长计算（排除 leisure tags）
- 按 tag 分类显示时长
- 格式：`45h 30m`

#### 6.2 周统计
- 5 天 / 7 天切换
- 每日开始/结束时间
- Break 时段自动标注
- 按 tag 分类时长
- 可展开显示迷你时间线

### 7. 窗口管理

- **默认全屏**：启动时 `setFullScreen(true)`
- **Mini 模式切换**：Alt+A 快捷键
- **状态同步**：使用 localStorage 同步 main/mini 窗口状态

### 8. 快捷键

- `Alt+X`：开始/停止录制
- `Alt+A`：切换全屏/mini 模式
- `Alt + 鼠标滚轮`：以鼠标位置为中心缩放时间线
- `Enter`（Record Modal）：开始录制/保存
- `Space`（Record Modal）：切换 tag 选择
- `↑↓←→`（Record Modal）：键盘导航

### 9. 数据库

#### 9.1 默认数据
- **默认标签**（安装时）：
  - Work (蓝色, #4285F4)
  - Lunch (绿色, #34A853)
  - Meeting (红色, #EA4335)
  - 全部非 leisure

#### 9.2 数据持久化
- IndexedDB (Dexie.js)
- 支持数据库迁移
- localStorage 用于窗口状态同步

---

## 待实现功能

### 高优先级
- [ ] Week view expanded 显示迷你时间线
- [ ] JSON 导入单词功能
- [ ] TTS 语音播放

### 中优先级
- [ ] 更多键盘快捷键提示
- [ ] 导出数据功能
- [ ] 数据备份与恢复

### 低优先级
- [ ] 主题切换（暗色模式）
- [ ] 更多统计图表
- [ ] 移动端适配

---

## 技术栈

- **前端框架**：React + TypeScript
- **状态管理**：Zustand (with persist middleware)
- **样式**：Tailwind CSS
- **数据库**：Dexie.js (IndexedDB)
- **日期处理**：date-fns
- **桌面框架**：Electron
- **构建工具**：Vite
- **打包工具**：electron-builder

---

## 打包配置

### Windows
- Portable 版本 (.exe)
- 禁用代码签名

### Linux
- tar.gz 格式（AppImage 需要 symlink 权限）

---

## 更新历史

### 2026-02-15
- ✅ Settings 页面添加颜色选择器和删除标签功能
- ✅ 窗口默认全屏启动
- ✅ Timeline 添加当前时间指示线和定位按钮
- ✅ Settings 改为自动保存，Close 按钮关闭窗口
- ✅ 默认标签简化为 Work/Lunch/Meeting（非 leisure）

### 2026-02-14
- ✅ Mini 窗口视觉优化（多次迭代尺寸和布局）
- ✅ 活动记录占位符参与列布局
- ✅ 所有标签改为圆角 pill 样式
- ✅ Windows 和 Linux 打包配置

---

_最后更新：2026-02-15_
